# RBAC系统权限改造计划

## 一、数据层改造

### 1.1 数据库改造
- 修改`sys_permission`表结构
  - 添加`pid` (父权限ID)字段
  - 添加`sort_order` (排序号)字段
  - 添加相关索引
- 重新设计权限数据
  - 设计层级结构
  - 编写数据迁移脚本

### 1.2 实体类改造
- 修改`SysPermission`实体类
  ```java
  private Long pid;           // 父权限ID
  private Integer sortOrder;  // 排序号
  private List<SysPermission> children; // 子权限集合
  private String parentName;  // 父权限名称
  private boolean hasChildren;// 是否有子权限
  ```
- 更新相关VO/DTO类

## 二、权限管理功能改造

### 2.1 权限CRUD操作改造
- 添加权限
  - 验证父权限是否存在
  - 生成正确的权限编码
- 删除权限
  - 检查是否存在子权限
  - 级联删除处理
- 修改权限
  - 维护层级关系
  - 更新子权限信息

### 2.2 权限查询改造
- 实现树形结构查询
- 分页查询适配
- 缓存策略优化

## 三、权限验证逻辑改造

### 3.1 权限判断逻辑
- 修改权限验证方法
  - 考虑父子权限关系
  - 优化权限判断性能
- 更新权限编码生成规则

### 3.2 缓存策略
- Redis缓存结构设计
- 缓存更新机制
- 缓存清理策略

## 四、前端改造

### 4.1 权限管理页面
- 实现树形表格展示
- 添加层级操作功能
  - 添加子权限
  - 移动权限位置
  - 排序功能

### 4.2 菜单处理
- 动态菜单生成改造
- 按钮权限控制优化

## 五、其他注意事项

### 5.1 数据迁移
- 编写数据迁移方案
- 制定迁移步骤
- 准备回滚方案

### 5.2 性能优化
- 树形结构查询优化
- 缓存策略优化
- 数据库索引优化

### 5.3 接口兼容
- 维护旧接口兼容
- 更新API文档
- 编写接口变更说明

## 六、改造步骤

1. 准备阶段
   - 备份数据
   - 准备迁移脚本
   - 测试环境验证

2. 执行阶段
   - 数据库结构修改
   - 代码改造
   - 数据迁移

3. 验证阶段
   - 功能测试
   - 性能测试
   - 回归测试

4. 上线阶段
   - 制定上线计划
   - 准备回滚方案
   - 监控系统运行