# 角色管理页面测试文档 v1.0.0 (2024-02-20)

## 1. 测试环境准备

### 1.1 启动服务
```bash
# 1. 进入前端项目目录
cd rbac-ui

# 2. 确保依赖已安装
npm install

# 3. 启动开发服务器
npm run dev
```

### 1.2 Mock数据配置
确认 `.env.development` 中的配置：
```bash
VITE_USE_MOCK=true  # 启用Mock数据
```

## 2. 功能测试步骤

### 2.1 页面访问测试
1. 访问角色管理页面
   - 打开浏览器访问：http://localhost:3000/system/role
   - 确认页面正确加载
   - 检查页面布局是否完整

2. 检查页面组件
   - 搜索区域是否显示
   - 工具栏是否显示
   - 表格是否显示
   - 分页组件是否显示

### 2.2 搜索功能测试
1. 基础搜索
   ```typescript
   // 测试角色名称搜索
   - 输入角色名称：管理员
   - 点击搜索按钮
   - 验证结果是否符合预期

   // 测试角色编码搜索
   - 输入角色编码：admin
   - 点击搜索按钮
   - 验证结果是否符合预期
   ```

2. 状态筛选
   ```typescript
   // 测试状态筛选
   - 选择状态：启用
   - 点击搜索按钮
   - 验证只显示启用状态的角色
   ```

3. 重置功能
   ```typescript
   // 测试重置功能
   - 输入搜索条件
   - 点击重置按钮
   - 验证表单是否清空
   - 验证是否重新加载数据
   ```

### 2.3 表格功能测试
1. 数据展示
   - 检查表格列是否完整
   - 验证数据显示是否正确
   - 检查日期格式化

2. 多选功能
   ```typescript
   // 测试多选功能
   - 点击表格复选框
   - 验证选中状态
   - 验证批量删除按钮状态
   ```

3. 状态切换
   ```typescript
   // 测试状态开关
   - 点击状态开关
   - 验证状态是否改变
   - 检查提示信息
   ```

### 2.4 操作功能测试
1. 删除操作
   ```typescript
   // 单个删除
   - 点击删除按钮
   - 确认弹窗显示
   - 验证删除结果
   - 检查提示信息

   // 批量删除
   - 选中多个角色
   - 点击批量删除
   - 确认弹窗显示
   - 验证删除结果
   ```

2. 状态管理
   ```typescript
   // 状态修改
   - 切换角色状态
   - 验证状态更新
   - 检查提示信息
   ```

### 2.5 分页功能测试
1. 分页切换
   ```typescript
   // 页码切换
   - 点击下一页
   - 验证数据更新
   - 点击上一页
   - 验证数据更新

   // 每页条数
   - 修改每页显示条数
   - 验证数据量变化
   ```

## 3. 异常测试

### 3.1 输入验证
1. 特殊字符输入
   - 在搜索框中输入特殊字符
   - 验证是否正常处理

2. 空值处理
   - 不输入任何条件直接搜索
   - 验证是否返回所有数据

3. 长度限制
   - 输入超长字符串
   - 验证是否有长度限制

### 3.2 错误处理
1. 网络错误
   - 模拟网络断开
   - 验证错误提示
   - 检查加载状态

2. 操作失败
   - 模拟删除失败
   - 验证错误提示
   - 检查数据状态

3. 并发操作
   - 快速切换页码
   - 快速切换状态
   - 验证是否正常处理

## 4. 测试要点

### 4.1 功能验证
- [ ] 页面正确加载
- [ ] 搜索功能正常
- [ ] 重置功能正常
- [ ] 表格显示正确
- [ ] 分页功能正常
- [ ] 删除功能正常
- [ ] 状态修改正常

### 4.2 界面验证
- [ ] 布局美观
- [ ] 响应式适配
- [ ] 操作流畅
- [ ] 提示信息清晰

### 4.3 性能验证
- [ ] 页面加载速度
- [ ] 操作响应速度
- [ ] 数据刷新速度

## 5. 问题记录

### 5.1 问题模板
```markdown
问题描述：
重现步骤：
1. 
2. 
3. 
预期结果：
实际结果：
```

### 5.2 已知问题
1. 角色表单组件未实现
2. 权限分配组件未实现
3. 搜索表单布局问题（已解决）
   ```markdown
   问题描述：搜索表单在输入搜索条件时会从一行变成两行显示
   重现步骤：
   1. 进入角色管理页面
   2. 在搜索框中输入较长的搜索条件
   3. 观察表单布局变化
   
   解决方案：
   使用 flex 布局优化搜索表单：
   ```scss
   .search-form {
     display: flex;
     flex-wrap: nowrap;
     align-items: flex-start;
     gap: 16px;

     .el-form-item {
       margin-right: 0;
       margin-bottom: 0;
       flex: 1;
       min-width: 200px;
       max-width: 300px;
     }

     .search-buttons {
       flex: none;
       min-width: auto;
     }
   }
   ```
   优化效果：
   - 表单项保持在同一行
   - 输入框宽度限制在合理范围
   - 布局稳定，不会因输入内容改变而变化
   ```

## 6. 后续开发建议
1. 完善角色表单功能
   - 实现新增角色
   - 实现编辑角色
   - 添加表单验证

2. 实现权限分配功能
   - 创建权限树组件
   - 实现权限选择
   - 实现权限保存

3. 优化用户体验
   - 添加批量操作确认
   - 优化加载状态显示
   - 添加操作成功提示

## 7. 更新记录

### 2024-02-20
- 创建测试文档
- 添加测试步骤
- 完善测试要点
- 记录已知问题
- 添加搜索表单布局问题解决方案

## 8. 下一步开发计划

### 8.1 角色表单组件（RoleForm.vue）
1. 创建表单组件
   - [ ] 基本信息输入
   - [ ] 表单验证
   - [ ] 提交处理

### 8.2 权限树组件（PermTree.vue）
1. 创建权限树组件
   - [ ] 树形结构展示
   - [ ] 权限选择功能
   - [ ] 权限保存功能

### 8.3 优化计划
1. 表单交互优化
   - [ ] 添加表单项校验规则
   - [ ] 优化提示信息
   - [ ] 完善错误处理

2. 权限树交互优化
   - [ ] 添加展开/折叠功能
   - [ ] 优化选择交互
   - [ ] 添加搜索功能

## 9. 更新记录

### 2024-02-20
- 创建测试文档
- 添加测试步骤
- 完善测试要点
- 记录已知问题
- 添加搜索表单布局问题解决方案
- 补充下一步开发计划 

## 10. 用户管理测试用例

### 10.1 用户名边界测试

#### 10.1.1 基础验证
```typescript
// 1. 长度测试
username = ""                    // 预期：不通过，必填项
username = "ab"                  // 预期：不通过，小于最小长度(3)
username = "a".repeat(21)        // 预期：不通过，超过最大长度(20)
username = "admin123"           // 预期：通过

// 2. 格式测试
username = "123user"            // 预期：不通过，必须以字母开头
username = "user@123"           // 预期：不通过，包含特殊字符
username = "user_123"           // 预期：通过，允许下划线
username = "userName"           // 预期：通过
```

#### 10.1.2 特殊情况测试
```typescript
// 1. 空格处理
username = "user name"          // 预期：不通过，不允许包含空格
username = " username"          // 预期：不通过，不允许首尾空格
username = "username "          // 预期：不通过，不允许首尾空格

// 2. 特殊字符
username = "user#name"          // 预期：不通过，包含非法字符#
username = "user@name"          // 预期：不通过，包含非法字符@
username = "user-name"          // 预期：不通过，包含非法字符-

// 3. 中文混合
username = "用户名"             // 预期：不通过，不允许中文
username = "user用户"           // 预期：不通过，不允许中文
```

#### 10.1.3 唯一性测试
```typescript
// 1. 重复用户名测试
// 步骤1：创建第一个用户
username = "testuser"           // 预期：通过

// 步骤2：再次使用相同用户名
username = "testuser"           // 预期：不通过，提示用户名已存在
```

### 10.2 密码边界测试

#### 10.2.1 基础验证
```typescript
// 1. 长度测试
password = ""                   // 预期：不通过，必填项
password = "12345"             // 预期：不通过，小于最小长度(6)
password = "a".repeat(21)      // 预期：不通过，超过最大长度(20)
password = "Admin123"          // 预期：通过

// 2. 复杂度测试
password = "123456"            // 预期：不通过，需要包含大小写字母
password = "abcdef"            // 预期：不通过，需要包含数字
password = "ABCDEF"            // 预期：不通过，需要包含小写字母
password = "Aa123456"          // 预期：通过
```

### 10.3 其他字段测试

#### 10.3.1 昵称测试
```typescript
// 1. 长度测试
nickname = ""                   // 预期：通过，允许为空
nickname = "张"                 // 预期：不通过，小于最小长度(2)
nickname = "测试".repeat(16)    // 预期：不通过，超过最大长度(30)
nickname = "测试用户"           // 预期：通过

// 2. 特殊字符测试
nickname = "测试@用户"          // 预期：通过，允许特殊字符
nickname = "Test用户123"        // 预期：通过，允许中英文混合
```

#### 10.3.2 邮箱测试
```typescript
// 1. 格式测试
email = "user@"                // 预期：不通过，无效邮箱格式
email = "@example.com"         // 预期：不通过，无效邮箱格式
email = "user@example"         // 预期：不通过，无效邮箱格式
email = "user@example.com"     // 预期：通过

// 2. 特殊情况
email = "user.name@example.com" // 预期：通过，允许点号
email = "user+test@example.com" // 预期：通过，允许加号
```

#### 10.3.3 手机号测试
```typescript
// 1. 格式测试
phone = "1234567890"           // 预期：不通过，非法手机号格式
phone = "2138001380000"        // 预期：不通过，非法手机号格式
phone = "13800138000"          // 预期：通过

// 2. 特殊情况
phone = "138001380001"         // 预期：不通过，超过11位
phone = "1380013800"           // 预期：不通过，少于11位
```

### 10.4 状态测试

#### 10.4.1 用户状态切换
```typescript
// 1. 普通用户状态切换
user.status = 1                // 当前：启用
toggleStatus(user)             // 预期：可以切换到禁用状态
user.status = 0                // 当前：禁用
toggleStatus(user)             // 预期：可以切换到启用状态

// 2. 超级管理员状态切换
admin.status = 1               // 当前：启用
toggleStatus(admin)            // 预期：不允许禁用，提示错误信息
```

#### 10.4.2 锁定状态测试
```typescript
// 1. 登录失败次数测试
user.loginFailCount = 0        // 初始状态
loginFail(user)                // 失败一次
expect(user.loginFailCount).toBe(1)  // 预期：失败次数+1

// 2. 自动锁定测试
user.loginFailCount = 5        // 达到最大失败次数
loginFail(user)                // 再次失败
expect(user.lockTime).not.toBeNull() // 预期：账号被锁定
```

### 10.5 角色分配测试

#### 10.5.1 基础角色分配
```typescript
// 1. 单角色分配
user.roles = []                // 初始无角色
assignRole(user, [ROLE_USER])  // 分配普通用户角色
expect(user.roles).toHaveLength(1)   // 预期：成功分配一个角色

// 2. 多角色分配
assignRole(user, [ROLE_USER, ROLE_ADMIN]) // 分配多个角色
expect(user.roles).toHaveLength(2)   // 预期：成功分配多个角色
```

#### 10.5.2 特殊情况测试
```typescript
// 1. 超级管理员角色分配
normalUser.roles = []          // 普通用户
assignRole(normalUser, [ROLE_SUPER_ADMIN]) // 尝试分配超管角色
// 预期：不通过，提示无权分配超级管理员角色

// 2. 禁用角色分配
disabledRole.status = 0        // 禁用状态的角色
assignRole(user, [disabledRole]) // 尝试分配禁用角色
// 预期：不通过，提示不能分配禁用的角色
```

### 10.6 批量操作测试

#### 10.6.1 批量删除测试
```typescript
// 1. 普通批量删除
selectedIds = [5, 6, 7]        // 选择多个普通用户
batchDelete(selectedIds)       // 执行批量删除
// 预期：成功删除，数据库中已删除这些用户

// 2. 包含超级管理员
selectedIds = [1, 5, 6]        // 包含超级管理员(id=1)
batchDelete(selectedIds)       // 执行批量删除
// 预期：不通过，提示不能删除超级管理员

// 3. 大批量删除测试
selectedIds = Array(101).fill().map((_, i) => i + 1) // 选择超过100个用户
batchDelete(selectedIds)       // 执行批量删除
// 预期：不通过，提示每次最多删除100个用户
```

### 10.7 测试执行步骤

1. 准备测试环境
   ```bash
   # 启动开发服务器
   npm run dev
   
   # 确认mock模式已启用
   # .env.development中VITE_USE_MOCK=true
   ```

2. 执行用户名测试
   - 进入用户管理页面
   - 点击新增用户
   - 按测试用例输入用户名
   - 验证表单验证结果
   - 记录测试结果

3. 执行密码测试
   - 在新增用户表单中
   - 按测试用例输入密码
   - 验证密码强度提示
   - 验证表单验证结果
   - 记录测试结果

4. 执行其他字段测试
   - 按顺序测试每个字段
   - 验证表单验证结果
   - 测试字段间的联动关系
   - 记录测试结果

5. 执行状态测试
   - 创建测试用户
   - 执行状态切换操作
   - 验证状态变化
   - 测试锁定机制
   - 记录测试结果

6. 执行角色分配测试
   - 选择测试用户
   - 执行角色分配
   - 验证权限变化
   - 测试特殊情况
   - 记录测试结果

7. 执行批量操作测试
   - 准备测试数据
   - 执行批量操作
   - 验证操作结果
   - 测试异常情况
   - 记录测试结果

### 10.8 测试结果记录模板

```markdown
测试用例：[用例名称]
测试时间：YYYY-MM-DD HH:mm:ss
测试人员：[姓名]

测试步骤：
1. [具体步骤1]
2. [具体步骤2]
3. [具体步骤3]

预期结果：
[描述预期的测试结果]

实际结果：
[描述实际的测试结果]

问题记录：
[如果有问题，记录具体问题]

解决方案：
[如果已解决，记录解决方案]

备注：
[其他需要说明的内容]
```

## 11. 更新记录

### 2024-02-21
- 添加用户管理模块测试用例
- 补充测试执行步骤
- 添加测试结果记录模板
- 完善边界测试用例 